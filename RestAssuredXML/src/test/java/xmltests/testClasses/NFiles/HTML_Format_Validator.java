package xmltests.testClasses.NFiles;

import org.w3c.tidy.Tidy;
import org.testng.annotations.Test;
import xmltests.modelClasses.nFiles.OdfBody;

import javax.xml.bind.JAXBContext;
import javax.xml.bind.Unmarshaller;
import java.io.StringReader;
import java.io.*;

import java.util.Objects;
import java.util.Set;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import static org.testng.Assert.*;

public class HTML_Format_Validator {
    private String xmlUrl;
    OdfBody odfBody;
//    private static final String XML_URL = "xxxxxxxxxxxxx"; // Update with actual API URL

    // Constructor to set XML URL dynamically
    public HTML_Format_Validator(String xmlUrl) {
        this.xmlUrl = xmlUrl;
    }

    @Test
    public void validateHtmlFormat(String xmlContent) {
        try {
            //get the DocumentType value for checking what type of Nfile we should validate
            JAXBContext context = JAXBContext.newInstance(OdfBody.class);
            Unmarshaller unmarshaller = context.createUnmarshaller();
            odfBody = (OdfBody) unmarshaller.unmarshal(new StringReader(xmlContent));

            //initialize an array of docTypes
            Set<String> docTypes = Set.of("DT_BIO_TEA_IMP","DT_BIO_NOC_IMP");
            String docType = odfBody.getDocumentType();
            Pattern pattern;

            // Use regex to extract CDATA content
            if(docTypes.contains(docType)){
                pattern = Pattern.compile("<Highlights>\\s*<!\\[CDATA\\[(.*?)\\]\\]>\\s*</Highlights>", Pattern.DOTALL);
            } else if (Objects.equals(docType,"DT_BIO_PAR_IMP")) {
                pattern = Pattern.compile("<Highlights Type=\"ATH\">\\s*<!\\[CDATA\\[(.*?)\\]\\]>\\s*</Highlights>", Pattern.DOTALL);
            } else{
                pattern = Pattern.compile("<Body>\\s*<!\\[CDATA\\[(.*?)\\]\\]>\\s*</Body>", Pattern.DOTALL);
            };

            Matcher matcher = pattern.matcher(xmlContent);
            String extractedData = "";
            if (matcher.find()) {
                extractedData = "<!DOCTYPE html><html><head><title>Validation</title></head><body>"
                        + matcher.group(1)
                        + "</body></html>";
            } else {
                System.out.println("No CDATA found!");
            }


//            String html = "<title></title><h3>Medallists Downhill Athlete </h3>  <table border=\"1\" cellpadding=\"5\" class=\"medals-table\"> <thead> <tr> <th>Year</th> <th>Location</th> <th>Gold</th> <th>Silver</th> <th>Bronze</th> </tr> </thead> <tbody> <tr> <td>2022</td> <td></td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Beat Feuz (SUI)</li> <li>Corinne Suter (SUI)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Johan Clarey (FRA)</li> <li>Sofia Goggia (ITA)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Matthias Mayer (AUT)</li> <li>Nadia Delago (ITA)</li> </ul> </td> </tr> <tr> <td>2018</td> <td>Russia</td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Aksel Lund Svindal (NOR)</li> <li>Sofia Goggia (ITA)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Kjetil Jansrud (NOR)</li> <li>Ragnhild Mowinckel (NOR)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Lindsey Vonn (USA)</li> <li>Beat Feuz (SUI)</li> </ul> </td> </tr> </tbody> </table> <h3>Medallists Team Parallel Slalom Team</h3> <table border=\"1\" cellpadding=\"5\" class=\"medals-table\"> <thead> <tr> <th>Year</th> <th>Location</th> <th>Gold</th> <th>Silver</th> <th>Bronze</th> </tr> </thead> <tbody> <tr> <td>2022</td> <td></td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Austria (AUT)</li> <li>Stefan Brennsteiner (AUT)</li> <li>Johannes Strolz (AUT)</li> <li>Katharina Truppe (AUT)</li> <li>Katharina Liensberger (AUT)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Germany (GER)</li> <li>Lena Duerr (GER)</li> <li>Alexander Schmid (GER)</li> <li>Julian Rauchfuss (GER)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Norway (NOR)</li> <li>Maria Therese Tviberg (NOR)</li> <li>Thea Stjernesund (NOR)</li> <li>Timon Haugan (NOR)</li> <li>Fabian Wilkens Solheim (NOR)</li> </ul> </td> </tr> <tr> <td>2018</td> <td>Russia</td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Switzerland (SUI)</li> <li>Denise Feierabend (SUI)</li> <li>Wendy Holdener (SUI)</li> <li>Daniel Yule (SUI)</li> <li>Ramon Zenhaeusern (SUI)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Austria (AUT)</li> <li>Michael Matt (AUT)</li> <li>Marco Schwarz (AUT)</li> <li>Katharina Gallhuber (AUT)</li> <li>Katharina Liensberger (AUT)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Nina Haver Loeseth (NOR)</li> <li>Norway (NOR)</li> <li>Leif Kristian Nestvold-Haugen (NOR)</li> <li>Sebastian Foss Solevaag (NOR)</li> <li>Kristin Lysdahl (NOR)</li> </ul> </td> </tr> </tbody> </table> <h3>Medallists Giant Slalom Athlete</h3> <table border=\"1\" cellpadding=\"5\" class=\"medals-table\"> <thead> <tr> <th>Year</th> <th>Location</th> <th>Gold</th> <th>Silver</th> <th>Bronze</th> </tr> </thead> <tbody> <tr> <td>2022</td> <td></td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Sara Hector (SWE)</li> <li>Marco Odermatt (SUI)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Federica Brignone (FIN)</li> <li>Zan Kranjec (SLO)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Lara Gut-Behrami (SUI)</li> <li>Mathieu Faivre (FRA)</li> </ul> </td> </tr> <tr> <td>2018</td> <td>Russia</td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Marcel Hirscher (AUT)</li> <li>Mikaela Shiffrin (USA)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Ragnhild Mowinckel (NOR)</li> <li>Henrik Kristoffersen (NOR)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Federica Brignone (FIN)</li> <li>Alexis Pinturault (FRA)</li> </ul> </td> </tr> <tr> <td>2014</td> <td></td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Tina Maze (SLO)</li> <li>Ted Ligety (USA)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Steve Missillier (FRA)</li> <li>Anna Veith (AUT)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Viktoria Rebensburg (GER)</li> <li>Alexis Pinturault (FRA)</li> </ul> </td> </tr> <tr> <td>2010</td> <td></td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Carlo Janka (SUI)</li> <li>Viktoria Rebensburg (GER)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Tina Maze (SLO)</li> <li>Kjetil Jansrud (NOR)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Elisabeth Goergl (AUT)</li> <li>Aksel Lund Svindal (NOR)</li> </ul> </td> </tr> </tbody> </table> <h3>Medallists Super G Athlete</h3> <table border=\"1\" cellpadding=\"5\" class=\"medals-table\"> <thead> <tr> <th>Year</th> <th>Location</th> <th>Gold</th> <th>Silver</th> <th>Bronze</th> </tr> </thead> <tbody> <tr> <td>2022</td> <td></td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Lara Gut-Behrami (SUI)</li> <li>Matthias Mayer (AUT)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Ryan Cochran Siegle (USA)</li> <li>Mirjam Puchner (AUT)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Aleksander Aamodt Kilde (NOR)</li> <li>Michelle Gisin (SUI)</li> </ul> </td> </tr> <tr> <td>2018</td> <td>Russia</td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Matthias Mayer (AUT)</li> <li>Ester Ledecka (CZE)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Anna Veith (AUT)</li> <li>Beat Feuz (SUI)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Kjetil Jansrud (NOR)</li> <li>Tina Weirather (LIE)</li> </ul> </td> </tr> </tbody> </table> <h3>Medallists Combined Athlete</h3> <table border=\"1\" cellpadding=\"5\" class=\"medals-table\"> <thead> <tr> <th>Year</th> <th>Location</th> <th>Gold</th> <th>Silver</th> <th>Bronze</th> </tr> </thead> <tbody> <tr> <td>2022</td> <td></td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Michelle Gisin (SUI)</li> <li>Johannes Strolz (AUT)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Wendy Holdener (SUI)</li> <li>Aleksander Aamodt Kilde (NOR)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Federica Brignone (FIN)</li> <li>James Crawford (CAN)</li> </ul> </td> </tr> <tr> <td>2018</td> <td>Russia</td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Marcel Hirscher (AUT)</li> <li>Michelle Gisin (SUI)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Alexis Pinturault (FRA)</li> <li>Mikaela Shiffrin (USA)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Victor Muffat Jeandet (FRA)</li> <li>Wendy Holdener (SUI)</li> </ul> </td> </tr> </tbody> </table> <h3>Medallists Slalom Athlete</h3> <table border=\"1\" cellpadding=\"5\" class=\"medals-table\"> <thead> <tr> <th>Year</th> <th>Location</th> <th>Gold</th> <th>Silver</th> <th>Bronze</th> </tr> </thead> <tbody> <tr> <td>2022</td> <td></td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Petra Vlhova (SVK)</li> <li>Clement Noel (FRA)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Johannes Strolz (AUT)</li> <li>Katharina Liensberger (AUT)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Wendy Holdener (SUI)</li> <li>Sebastian Foss Solevaag (NOR)</li> </ul> </td> </tr> <tr> <td>2018</td> <td>Russia</td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Andre Myhrer (SWE)</li> <li>Frida Hansdotter (SWE)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Wendy Holdener (SUI)</li> <li>Ramon Zenhaeusern (SUI)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Michael Matt (AUT)</li> <li>Katharina Gallhuber (AUT)</li> </ul> </td> </tr> <tr> <td>2014</td> <td></td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Mario Matt (AUT)</li> <li>Mikaela Shiffrin (USA)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Marlies Schild (AUT)</li> <li>Marcel Hirscher (AUT)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Kathrin Zettel (AUT)</li> <li>Henrik Kristoffersen (NOR)</li> </ul> </td> </tr> <tr> <td>2010</td> <td></td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Maria Hoefl-Riesch (GER)</li> <li>Giuliano Razzoli (ITA)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Marlies Schild (AUT)</li> <li>Ivica Kostelic (CRO)</li> </ul> </td> <td> <ul style=\"margin: 0; padding-left: 20px;\"> <li>Andre Myhrer (SWE)</li> <li>Sarka Strachova (CZE)</li> </ul> </td> </tr> </tbody> </table>";
//            String n11html = "<title></title><p><b>Olympic Winter Games: Men 1936 - 2022 / Women 1936 - 2022 / Mixed 2018 - 2022</b></p> <table> <thead> <tr> <th class=\"text-align-right\"><b>Rank</b></th> <th class=\"text-align-left\"><b>NOC</b></th> <th colspan=\"4\" class=\"text-align-center\">Men</th> <th colspan=\"4\" class=\"text-align-center\">Women</th> <th colspan=\"4\" class=\"text-align-center\">Mixed</th> <th colspan=\"4\" class=\"text-align-center\">Total</th> <th class=\"text-align-right\">Rank<br/> by<br/> Total</th> </tr> <tr> <th></th> <th></th> <th>G</th> <th>S</th> <th>B</th> <th>Tot.</th> <th>G</th> <th>S</th> <th>B</th> <th>Tot.</th> <th>G</th> <th>S</th> <th>B</th> <th>Tot.</th> <th>G</th> <th>S</th> <th>B</th> <th>Tot.</th> <th></th> </tr> </thead> <tbody> <tr> <td class=\"text-align-right\">1</td> <td class=\"text-align-left\">AUT - Austria</td> <td class=\"text-align-right\">26</td> <td class=\"text-align-right\">20</td> <td class=\"text-align-right\">26</td> <td class=\"text-align-right\">72</td> <td class=\"text-align-right\">13</td> <td class=\"text-align-right\">23</td> <td class=\"text-align-right\">18</td> <td class=\"text-align-right\">54</td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">40</td> <td class=\"text-align-right\">43</td> <td class=\"text-align-right\">44</td> <td class=\"text-align-right\">127</td> <td class=\"text-align-right\">1</td> </tr> <tr> <td class=\"text-align-right\">2</td> <td class=\"text-align-left\">SUI - Switzerland</td> <td class=\"text-align-right\">11</td> <td class=\"text-align-right\">13</td> <td class=\"text-align-right\">13</td> <td class=\"text-align-right\">37</td> <td class=\"text-align-right\">15</td> <td class=\"text-align-right\">10</td> <td class=\"text-align-right\">12</td> <td class=\"text-align-right\">37</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">26</td> <td class=\"text-align-right\">23</td> <td class=\"text-align-right\">25</td> <td class=\"text-align-right\">74</td> <td class=\"text-align-right\">2</td> </tr> <tr> <td class=\"text-align-right\">3</td> <td class=\"text-align-left\">USA - United States</td> <td class=\"text-align-right\">6</td> <td class=\"text-align-right\">9</td> <td class=\"text-align-right\">4</td> <td class=\"text-align-right\">19</td> <td class=\"text-align-right\">11</td> <td class=\"text-align-right\">12</td> <td class=\"text-align-right\">6</td> <td class=\"text-align-right\">29</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">17</td> <td class=\"text-align-right\">21</td> <td class=\"text-align-right\">10</td> <td class=\"text-align-right\">48</td> <td class=\"text-align-right\">4</td> </tr> <tr> <td class=\"text-align-right\">4</td> <td class=\"text-align-left\">FRA - France</td> <td class=\"text-align-right\">12</td> <td class=\"text-align-right\">9</td> <td class=\"text-align-right\">11</td> <td class=\"text-align-right\">32</td> <td class=\"text-align-right\">4</td> <td class=\"text-align-right\">8</td> <td class=\"text-align-right\">7</td> <td class=\"text-align-right\">19</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">16</td> <td class=\"text-align-right\">17</td> <td class=\"text-align-right\">18</td> <td class=\"text-align-right\">51</td> <td class=\"text-align-right\">3</td> </tr> <tr> <td class=\"text-align-right\">5</td> <td class=\"text-align-left\">ITA - Italy</td> <td class=\"text-align-right\">8</td> <td class=\"text-align-right\">6</td> <td class=\"text-align-right\">3</td> <td class=\"text-align-right\">17</td> <td class=\"text-align-right\">6</td> <td class=\"text-align-right\">5</td> <td class=\"text-align-right\">8</td> <td class=\"text-align-right\">19</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">14</td> <td class=\"text-align-right\">11</td> <td class=\"text-align-right\">11</td> <td class=\"text-align-right\">36</td> <td class=\"text-align-right\">6</td> </tr> <tr> <td class=\"text-align-right\">6</td> <td class=\"text-align-left\">GER - Germany</td> <td class=\"text-align-right\">3</td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">6</td> <td class=\"text-align-right\">11</td> <td class=\"text-align-right\">6</td> <td class=\"text-align-right\">8</td> <td class=\"text-align-right\">25</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">14</td> <td class=\"text-align-right\">9</td> <td class=\"text-align-right\">9</td> <td class=\"text-align-right\">32</td> <td class=\"text-align-right\">7</td> </tr> <tr> <td class=\"text-align-right\">7</td> <td class=\"text-align-left\">NOR - Norway</td> <td class=\"text-align-right\">11</td> <td class=\"text-align-right\">12</td> <td class=\"text-align-right\">12</td> <td class=\"text-align-right\">35</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">3</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">11</td> <td class=\"text-align-right\">14</td> <td class=\"text-align-right\">14</td> <td class=\"text-align-right\">39</td> <td class=\"text-align-right\">5</td> </tr> <tr> <td class=\"text-align-right\">8</td> <td class=\"text-align-left\">SWE - Sweden</td> <td class=\"text-align-right\">3</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">4</td> <td class=\"text-align-right\">7</td> <td class=\"text-align-right\">5</td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\">5</td> <td class=\"text-align-right\">12</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">8</td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\">9</td> <td class=\"text-align-right\">19</td> <td class=\"text-align-right\">8</td> </tr> <tr> <td class=\"text-align-right\">9</td> <td class=\"text-align-left\">CRO - Croatia</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">4</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">4</td> <td class=\"text-align-right\">4</td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">6</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">4</td> <td class=\"text-align-right\">6</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">10</td> <td class=\"text-align-right\">=10</td> </tr> <tr> <td class=\"text-align-right\">10</td> <td class=\"text-align-left\">CAN - Canada</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">4</td> <td class=\"text-align-right\">4</td> <td class=\"text-align-right\">4</td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">3</td> <td class=\"text-align-right\">8</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">4</td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">7</td> <td class=\"text-align-right\">12</td> <td class=\"text-align-right\">9</td> </tr> <tr> <td class=\"text-align-right\">11</td> <td class=\"text-align-left\">FRG - Federal Republic of Germany</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">3</td> <td class=\"text-align-right\">4</td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">8</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">3</td> <td class=\"text-align-right\">5</td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">9</td> <td class=\"text-align-right\">12</td> </tr> <tr> <td class=\"text-align-right\">12</td> <td class=\"text-align-left\">SLO - Slovenia</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\">6</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\">3</td> <td class=\"text-align-right\">3</td> <td class=\"text-align-right\">8</td> <td class=\"text-align-right\">13</td> </tr> <tr> <td class=\"text-align-right\">13</td> <td class=\"text-align-left\">LIE - Liechtenstein</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">3</td> <td class=\"text-align-right\">4</td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">3</td> <td class=\"text-align-right\">6</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\">6</td> <td class=\"text-align-right\">10</td> <td class=\"text-align-right\">=10</td> </tr> <tr> <td class=\"text-align-right\">14</td> <td class=\"text-align-left\">CZE - Czechia</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\">=14</td> </tr> <tr> <td class=\"text-align-right\">14</td> <td class=\"text-align-left\">ESP - Spain</td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\">=14</td> </tr> <tr> <td class=\"text-align-right\">16</td> <td class=\"text-align-left\">SVK - Slovakia</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">=18</td> </tr> <tr> <td class=\"text-align-right\">17</td> <td class=\"text-align-left\">YUG - Yugoslavia</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\">=14</td> </tr> <tr> <td class=\"text-align-right\">17</td> <td class=\"text-align-left\">LUX - Luxembourg</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">2</td> <td class=\"text-align-right\">=14</td> </tr> <tr> <td class=\"text-align-right\">19</td> <td class=\"text-align-left\">RUS - Russian Fed.</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">=18</td> </tr> <tr> <td class=\"text-align-right\">19</td> <td class=\"text-align-left\">JPN - Japan</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">=18</td> </tr> <tr> <td class=\"text-align-right\">19</td> <td class=\"text-align-left\">FIN - Finland</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">=18</td> </tr> <tr> <td class=\"text-align-right\">19</td> <td class=\"text-align-left\">NZL - New Zealand</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">=18</td> </tr> <tr> <td class=\"text-align-right\">23</td> <td class=\"text-align-left\">TCH - Czechoslovakia</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">=18</td> </tr> <tr> <td class=\"text-align-right\">23</td> <td class=\"text-align-left\">URS - Soviet Union</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">=18</td> </tr> <tr> <td class=\"text-align-right\">23</td> <td class=\"text-align-left\">AUS - Australia</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\"></td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">1</td> <td class=\"text-align-right\">=18</td> </tr> <tr> <td class=\"text-align-left\"></td> <td class=\"text-end \"><b>Total:</b></td> <td class=\"text-align-right\"><b>81</b></td> <td class=\"text-align-right\"><b>82</b></td> <td class=\"text-align-right\"><b>82</b></td> <td class=\"text-align-right\"><b>245</b></td> <td class=\"text-align-right\"><b>82</b></td> <td class=\"text-align-right\"><b>82</b></td> <td class=\"text-align-right\"><b>79</b></td> <td class=\"text-align-right\"><b>243</b></td> <td class=\"text-align-right\"><b>1</b></td> <td class=\"text-align-right\"><b>1</b></td> <td class=\"text-align-right\"><b>1</b></td> <td class=\"text-align-right\"><b>3</b></td> <td class=\"text-align-right\"><b>164</b></td> <td class=\"text-align-right\"><b>165</b></td> <td class=\"text-align-right\"><b>162</b></td> <td class=\"text-align-right\"><b>491</b></td> <td class=\"text-align-left\"></td> </tr> </tbody> </table> <p><b>Note:</b></p> <p>\"Mixed\" is used for events in which male and female athletes are required to compete together as a team. \"Open\" is used for events which are open to both male and female athletes.</p> <p>Please note that some of the NOCs presented may no longer exist.</p> <p><b>Legend:</b></p> <p><b>= </b>Equal sign indicates that two or more NOCs share the same rank by total. <b>B</b> Bronze<b> G</b> Gold <b> S</b> Silver</p> <p><b>Tot. </b>Total</p>";
//            String n11WithLink = "<title></title><p><b>Olympic Winter Games: Men 1936 - 2022 / Women 1936 - 2022 / Mixed 2018 - 2022</b></p><div class=\"medals-by-noc\"> <link rel=\"stylesheet\" /></div> ";
            // Parse the HTML content from the string variable
            try (InputStream input = new ByteArrayInputStream(extractedData.getBytes());
                 ByteArrayOutputStream output = new ByteArrayOutputStream()) {

                    // Create an error stream to capture Tidy's warnings and errors
                    ByteArrayOutputStream errorStream = new ByteArrayOutputStream();
                    PrintWriter errorPrintWriter = new PrintWriter(errorStream);

                    Tidy tidy = new Tidy();
                    tidy.setShowWarnings(true);  // Show warnings
                    tidy.setQuiet(true);        // Show errors
//                    tidy.setForceOutput(true);  // Stop if there are errors
                    tidy.setPrintBodyOnly(true);
                    tidy.setErrout(errorPrintWriter);// Only validate inside <body>
                    tidy.parse(input, output);

                    // Flush the PrintWriter to ensure all data is written to the errorStream
                    errorPrintWriter.flush();

                    // Get the error/warning output
                    String errors = errorStream.toString();

//                    System.out.println("Errors: "+errors);
                    // If there are errors or warnings, fail the test
                    if (!errors.isEmpty()) {
                        //get the CategoryName
                        String categoryName = odfBody.getCompetition().getCategories().getCategory().getCategoryName();
                        //get the discipline
                        String documentSubcode = odfBody.getDocumentSubcode();

                        fail("HTML parsing failed with errors or warnings:\n" + errors + " for the following sport: " + categoryName + " and discipline: " + documentSubcode);
                    }

                } catch (Exception e) {
                    fail("Error parsing HTML: " + e.getMessage());
                }

        } catch (Exception e) {
            fail("Error parsing HTML: " + e.getMessage());
        }
    }
}
